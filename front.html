<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Tracking with Mediapipe</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        video {
            border: 2px solid black;
            margin-bottom: 20px;
        }
        .coordinates {
            font-size: 18px;
            color: #333;
            text-align: center;
        }
    </style>
</head>
<body>
    <div>
        <video id="videoElement" width="640" height="480" autoplay></video>
        <div class="coordinates" id="coordinates">
            <!-- Coordinates will be shown here -->
        </div>
    </div>

    <script>
        const videoElement = document.getElementById("videoElement");
        const coordinatesDiv = document.getElementById("coordinates");

        // Define HandTracker class first
        class HandTracker {
            constructor() {
                this.handModel = null;
                this.init();
            }

            async init() {
                // Load the Mediapipe hand tracking model
                const { Hands } = await import('https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.3.1636346792/dist/hands.js');
                const { DrawingUtils } = await import('https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1636346792/dist/drawing_utils.js');

                this.hands = new Hands({
                    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.3.1636346792/${file}`,
                });
                this.hands.setOptions({
                    minDetectionConfidence: 0.7,
                    minTrackingConfidence: 0.7,
                });

                this.hands.onResults(this.onResults.bind(this));

                // Capture video frame and detect hands
                this.video = document.querySelector('video');
                this.canvas = document.createElement("canvas");
                this.canvas.width = this.video.width;
                this.canvas.height = this.video.height;
                document.body.appendChild(this.canvas);
                this.canvas.style.position = "absolute";
                this.canvas.style.top = this.video.offsetTop + "px";
                this.canvas.style.left = this.video.offsetLeft + "px";
                this.canvasCtx = this.canvas.getContext('2d');

                const detectHand = () => {
                    this.hands.send({ image: this.video });
                    requestAnimationFrame(detectHand);
                };
                detectHand();
            }

            onResults(results) {
                this.canvasCtx.save();
                this.canvasCtx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.canvasCtx.drawImage(results.image, 0, 0);
                DrawingUtils.drawLandmarks(this.canvasCtx, results.multiHandLandmarks, DrawingUtils.HAND_CONNECTIONS);

                if (results.multiHandLandmarks) {
                    // Display Thumb Tip Coordinates
                    const thumbTip = results.multiHandLandmarks[0][4]; // Thumb tip landmark index
                    coordinatesDiv.innerHTML = `
                        Thumb Tip Coordinates: 
                        X: ${thumbTip.x.toFixed(2)}, 
                        Y: ${thumbTip.y.toFixed(2)}
                    `;
                }
                this.canvasCtx.restore();
            }
        }

        // Start webcam feed
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                videoElement.srcObject = stream;
            })
            .catch(error => {
                console.log("Error accessing webcam: ", error);
            });

        // Setup for hand tracking with Mediapipe
        const handTracker = new HandTracker();
    </script>
</body>
</html>
